{"version":3,"sources":["../../src/components/discovery.js"],"names":["Discover","require","colors","defaultOptions","helloInterval","checkInterval","nodeTimeout","masterTimeout","monitor","log","helloLogsEnabled","statusLogsEnabled","ignoreProcess","Discovery","constructor","advertisement","options","defaults","type","advertise","me","id","broadcast","instanceUuid","processId","processUuid","processCommand","process","argv","slice","map","n","split","join","helloLogger","on","obj","key","statusLogger","setDefaults","logs","console","apply","white","status","statusLog","green","red","push","name","magenta","grey","port","toString","blue","module","exports"],"mappings":"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","sourcesContent":["const Discover = require('@dashersw/node-discover');\n\n// eslint-disable-next-line\nconst colors = require('colors');\n\nconst defaultOptions = {\n    helloInterval: 2000,\n    checkInterval: 4000,\n    nodeTimeout: 5000,\n    masterTimeout: 6000,\n    monitor: false,\n    log: true,\n    helloLogsEnabled: true,\n    statusLogsEnabled: true,\n    ignoreProcess: false,\n};\n\nclass Discovery extends Discover {\n    constructor(advertisement, options) {\n        options = { ...defaultOptions, ...Discovery.defaults, ...options };\n\n        super(options);\n\n        this.advertisement = { type: 'service', ...advertisement };\n\n        this.advertise(this.advertisement);\n\n        this.me.id = this.broadcast.instanceUuid;\n        this.me.processId = this.broadcast.processUuid;\n        this.me.processCommand = process.argv.slice(1).map((n) => {\n            return n.split('/').slice(-2).join('/');\n        }).join(' ');\n\n        options.log && this.log(this.helloLogger());\n\n        this.on('added', (obj) => {\n            if (!options.monitor && obj.advertisement.key != this.advertisement.key) return;\n\n            options.log && options.statusLogsEnabled && options.helloLogsEnabled &&\n                this.log(this.statusLogger(obj, 'online'));\n        });\n\n        this.on('removed', (obj) => {\n            if (!options.monitor && obj.advertisement.key != this.advertisement.key) return;\n\n            options.log && options.statusLogsEnabled &&\n                this.log(this.statusLogger(obj, 'offline'));\n        });\n    }\n\n    static setDefaults(options) {\n        this.defaults = options;\n    }\n\n    log(logs) {\n        console.log.apply(console.log, logs);\n    }\n\n    helloLogger() {\n        return ['\\nHello! I\\'m'.white, ...this.statusLogger(this.me), '\\n========================\\n'.white];\n    }\n\n    statusLogger(obj, status) {\n        const logs = [];\n\n        if (status) {\n            const statusLog = status == 'online' ? '.online'.green : '.offline'.red;\n            logs.push(this.advertisement.name, '>', obj.advertisement.type.magenta + statusLog);\n        } else {\n            logs.push();\n        }\n\n        logs.push(\n            `${obj.advertisement.name.white}${'#'.grey}${obj.id.grey}`);\n\n        if (obj.advertisement.port) {\n            logs.push('on', obj.advertisement.port.toString().blue);\n        }\n\n        return logs;\n    }\n}\n\nmodule.exports = Discovery;\n"],"file":"discovery.js"}