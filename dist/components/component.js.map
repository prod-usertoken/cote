{"version":3,"sources":["../../src/components/component.js"],"names":["EventEmitter","require","EventEmitter2","Discovery","module","exports","Component","constructor","advertisement","discoveryOptions","wildcard","delimiter","newListener","maxListeners","key","environment","axon_type","type","address","startDiscovery","discovery","on","obj","oppo","namespace","onAdded","emit","onRemoved","close","sock","stop"],"mappings":";;AAAA,MAAMA,YAAY,GAAGC,OAAO,CAAC,eAAD,CAAP,CAAyBC,aAA9C;;AACA,MAAMC,SAAS,GAAGF,OAAO,CAAC,aAAD,CAAzB;;AAEAG,MAAM,CAACC,OAAP,GAAiB,MAAMC,SAAN,SAAwBN,YAAxB,CAAqC;AAClDO,EAAAA,WAAW,CAACC,aAAD,EAAgBC,gBAAgB,GAAG,EAAnC,EAAuC;AAC9C,UAAM;AACFC,MAAAA,QAAQ,EAAE,IADR;AACc;AAChBC,MAAAA,SAAS,EAAE,IAFT;AAEe;AACjBC,MAAAA,WAAW,EAAE,KAHX;AAGkB;AACpBC,MAAAA,YAAY,EAAE,IAJZ,CAIkB;;AAJlB,KAAN;AAOAL,IAAAA,aAAa,CAACM,GAAd,GAAoB,KAAKP,WAAL,CAAiBQ,WAAjB,GAA+B,IAA/B,IAAuCP,aAAa,CAACM,GAAd,IAAqB,EAA5D,CAApB;AAEA,SAAKN,aAAL,GAAqBA,aAArB;AACA,SAAKA,aAAL,CAAmBQ,SAAnB,GAA+B,KAAKC,IAApC;AAEA,SAAKR,gBAAL,GAAwBA,gBAAxB;AACA,SAAKA,gBAAL,CAAsBS,OAAtB,GAAgC,KAAKT,gBAAL,CAAsBS,OAAtB,IAAiC,SAAjE;AACH;;AAEDC,EAAAA,cAAc,GAAG;AACb,SAAKC,SAAL,GAAiB,IAAIjB,SAAJ,CAAc,KAAKK,aAAnB,EAAkC,KAAKC,gBAAvC,CAAjB;AAEA,SAAKW,SAAL,CAAeC,EAAf,CAAkB,OAAlB,EAA4BC,GAAD,IAAS;AAChC,UACIA,GAAG,CAACd,aAAJ,CAAkBQ,SAAlB,IAA+B,KAAKO,IAApC,IACAD,GAAG,CAACd,aAAJ,CAAkBM,GAAlB,IAAyB,KAAKN,aAAL,CAAmBM,GAD5C,IAEA,KAAKN,aAAL,CAAmBgB,SAAnB,IAAgCF,GAAG,CAACd,aAAJ,CAAkBgB,SAHtD,EAIE;AAEF,WAAKC,OAAL,CAAaH,GAAb;AACA,WAAKI,IAAL,CAAU,YAAV,EAAwBJ,GAAxB;AACH,KATD;AAUA,SAAKF,SAAL,CAAeC,EAAf,CAAkB,SAAlB,EAA8BC,GAAD,IAAS;AAClC,UACIA,GAAG,CAACd,aAAJ,CAAkBQ,SAAlB,IAA+B,KAAKO,IAApC,IACAD,GAAG,CAACd,aAAJ,CAAkBM,GAAlB,IAAyB,KAAKN,aAAL,CAAmBM,GAD5C,IAEA,KAAKN,aAAL,CAAmBgB,SAAnB,IAAgCF,GAAG,CAACd,aAAJ,CAAkBgB,SAHtD,EAIE;AAEF,WAAKG,SAAL,CAAeL,GAAf;AACA,WAAKI,IAAL,CAAU,cAAV,EAA0BJ,GAA1B;AACH,KATD;AAUH;;AAEDG,EAAAA,OAAO,GAAG,CAAG;;AAEbE,EAAAA,SAAS,GAAG,CAAG;;AAEfC,EAAAA,KAAK,GAAG;AACJ,SAAKC,IAAL,IAAa,KAAKA,IAAL,CAAUD,KAAV,EAAb;AACA,SAAKR,SAAL,IAAkB,KAAKA,SAAL,CAAeU,IAAf,EAAlB;AACH;;AAlDiD,CAAtD","sourcesContent":["const EventEmitter = require('eventemitter2').EventEmitter2;\nconst Discovery = require('./discovery');\n\nmodule.exports = class Component extends EventEmitter {\n    constructor(advertisement, discoveryOptions = {}) {\n        super({\n            wildcard: true, // should the event emitter use wildcards.\n            delimiter: '::', // the delimiter used to segment namespaces, defaults to `.`.\n            newListener: false, // if you want to emit the newListener event set to true.\n            maxListeners: 2000, // the max number of listeners that can be assigned to an event, defaults to 10.\n        });\n\n        advertisement.key = this.constructor.environment + '$$' + (advertisement.key || '');\n\n        this.advertisement = advertisement;\n        this.advertisement.axon_type = this.type;\n\n        this.discoveryOptions = discoveryOptions;\n        this.discoveryOptions.address = this.discoveryOptions.address || '0.0.0.0';\n    }\n\n    startDiscovery() {\n        this.discovery = new Discovery(this.advertisement, this.discoveryOptions);\n\n        this.discovery.on('added', (obj) => {\n            if (\n                obj.advertisement.axon_type != this.oppo ||\n                obj.advertisement.key != this.advertisement.key ||\n                this.advertisement.namespace != obj.advertisement.namespace\n            ) return;\n\n            this.onAdded(obj);\n            this.emit('cote:added', obj);\n        });\n        this.discovery.on('removed', (obj) => {\n            if (\n                obj.advertisement.axon_type != this.oppo ||\n                obj.advertisement.key != this.advertisement.key ||\n                this.advertisement.namespace != obj.advertisement.namespace\n            ) return;\n\n            this.onRemoved(obj);\n            this.emit('cote:removed', obj);\n        });\n    }\n\n    onAdded() { };\n\n    onRemoved() { };\n\n    close() {\n        this.sock && this.sock.close();\n        this.discovery && this.discovery.stop();\n    }\n};\n"],"file":"component.js"}